{"ast":null,"code":"// Load modules\nvar Fs = require('fs');\n\nvar Escape = require('./escape'); // Declare internals\n\n\nvar internals = {}; // Clone object or array\n\nexports.clone = function (obj, seen) {\n  if (typeof obj !== 'object' || obj === null) {\n    return obj;\n  }\n\n  seen = seen || {\n    orig: [],\n    copy: []\n  };\n  var lookup = seen.orig.indexOf(obj);\n\n  if (lookup !== -1) {\n    return seen.copy[lookup];\n  }\n\n  var newObj = obj instanceof Array ? [] : {};\n  seen.orig.push(obj);\n  seen.copy.push(newObj);\n\n  for (var i in obj) {\n    if (obj.hasOwnProperty(i)) {\n      if (obj[i] instanceof Buffer) {\n        newObj[i] = new Buffer(obj[i]);\n      } else if (obj[i] instanceof Date) {\n        newObj[i] = new Date(obj[i].getTime());\n      } else if (obj[i] instanceof RegExp) {\n        var flags = '' + (obj[i].global ? 'g' : '') + (obj[i].ignoreCase ? 'i' : '') + (obj[i].multiline ? 'm' : '');\n        newObj[i] = new RegExp(obj[i].source, flags);\n      } else {\n        newObj[i] = exports.clone(obj[i], seen);\n      }\n    }\n  }\n\n  return newObj;\n}; // Merge all the properties of source into target, source wins in conflic, and by default null and undefined from source are applied\n\n\nexports.merge = function (target, source, isNullOverride\n/* = true */\n, isMergeArrays\n/* = true */\n) {\n  exports.assert(target && typeof target == 'object', 'Invalid target value: must be an object');\n  exports.assert(source === null || source === undefined || typeof source === 'object', 'Invalid source value: must be null, undefined, or an object');\n\n  if (!source) {\n    return target;\n  }\n\n  if (source instanceof Array) {\n    exports.assert(target instanceof Array, 'Cannot merge array onto an object');\n\n    if (isMergeArrays === false) {\n      // isMergeArrays defaults to true\n      target.length = 0; // Must not change target assignment\n    }\n\n    for (var i = 0, il = source.length; i < il; ++i) {\n      target.push(source[i]);\n    }\n\n    return target;\n  }\n\n  var keys = Object.keys(source);\n\n  for (var k = 0, kl = keys.length; k < kl; ++k) {\n    var key = keys[k];\n    var value = source[key];\n\n    if (value && typeof value === 'object') {\n      if (!target[key] || typeof target[key] !== 'object') {\n        target[key] = exports.clone(value);\n      } else {\n        exports.merge(target[key], source[key], isNullOverride, isMergeArrays);\n      }\n    } else {\n      if (value !== null && value !== undefined) {\n        // Explicit to preserve empty strings\n        target[key] = value;\n      } else if (isNullOverride !== false) {\n        // Defaults to true\n        target[key] = value;\n      }\n    }\n  }\n\n  return target;\n}; // Apply options to a copy of the defaults\n\n\nexports.applyToDefaults = function (defaults, options) {\n  exports.assert(defaults && typeof defaults == 'object', 'Invalid defaults value: must be an object');\n  exports.assert(!options || options === true || typeof options === 'object', 'Invalid options value: must be true, falsy or an object');\n\n  if (!options) {\n    // If no options, return null\n    return null;\n  }\n\n  var copy = exports.clone(defaults);\n\n  if (options === true) {\n    // If options is set to true, use defaults\n    return copy;\n  }\n\n  return exports.merge(copy, options, false, false);\n}; // Remove duplicate items from array\n\n\nexports.unique = function (array, key) {\n  var index = {};\n  var result = [];\n\n  for (var i = 0, il = array.length; i < il; ++i) {\n    var id = key ? array[i][key] : array[i];\n\n    if (index[id] !== true) {\n      result.push(array[i]);\n      index[id] = true;\n    }\n  }\n\n  return result;\n}; // Convert array into object\n\n\nexports.mapToObject = function (array, key) {\n  if (!array) {\n    return null;\n  }\n\n  var obj = {};\n\n  for (var i = 0, il = array.length; i < il; ++i) {\n    if (key) {\n      if (array[i][key]) {\n        obj[array[i][key]] = true;\n      }\n    } else {\n      obj[array[i]] = true;\n    }\n  }\n\n  return obj;\n}; // Find the common unique items in two arrays\n\n\nexports.intersect = function (array1, array2, justFirst) {\n  if (!array1 || !array2) {\n    return [];\n  }\n\n  var common = [];\n  var hash = array1 instanceof Array ? exports.mapToObject(array1) : array1;\n  var found = {};\n\n  for (var i = 0, il = array2.length; i < il; ++i) {\n    if (hash[array2[i]] && !found[array2[i]]) {\n      if (justFirst) {\n        return array2[i];\n      }\n\n      common.push(array2[i]);\n      found[array2[i]] = true;\n    }\n  }\n\n  return justFirst ? null : common;\n}; // Find which keys are present\n\n\nexports.matchKeys = function (obj, keys) {\n  var matched = [];\n\n  for (var i = 0, il = keys.length; i < il; ++i) {\n    if (obj.hasOwnProperty(keys[i])) {\n      matched.push(keys[i]);\n    }\n  }\n\n  return matched;\n}; // Flatten array\n\n\nexports.flatten = function (array, target) {\n  var result = target || [];\n\n  for (var i = 0, il = array.length; i < il; ++i) {\n    if (Array.isArray(array[i])) {\n      exports.flatten(array[i], result);\n    } else {\n      result.push(array[i]);\n    }\n  }\n\n  return result;\n}; // Remove keys\n\n\nexports.removeKeys = function (object, keys) {\n  for (var i = 0, il = keys.length; i < il; i++) {\n    delete object[keys[i]];\n  }\n}; // Convert an object key chain string ('a.b.c') to reference (object[a][b][c])\n\n\nexports.reach = function (obj, chain) {\n  var path = chain.split('.');\n  var ref = obj;\n\n  for (var i = 0, il = path.length; i < il; ++i) {\n    if (ref) {\n      ref = ref[path[i]];\n    }\n  }\n\n  return ref;\n}; // Inherits a selected set of methods from an object, wrapping functions in asynchronous syntax and catching errors\n\n\nexports.inheritAsync = function (self, obj, keys) {\n  keys = keys || null;\n\n  for (var i in obj) {\n    if (obj.hasOwnProperty(i)) {\n      if (keys instanceof Array && keys.indexOf(i) < 0) {\n        continue;\n      }\n\n      self.prototype[i] = function (fn) {\n        return function (next) {\n          var result = null;\n\n          try {\n            result = fn();\n          } catch (err) {\n            return next(err);\n          }\n\n          return next(null, result);\n        };\n      }(obj[i]);\n    }\n  }\n};\n\nexports.formatStack = function (stack) {\n  var trace = [];\n\n  for (var i = 0, il = stack.length; i < il; ++i) {\n    var item = stack[i];\n    trace.push([item.getFileName(), item.getLineNumber(), item.getColumnNumber(), item.getFunctionName(), item.isConstructor()]);\n  }\n\n  return trace;\n};\n\nexports.formatTrace = function (trace) {\n  var display = [];\n\n  for (var i = 0, il = trace.length; i < il; ++i) {\n    var row = trace[i];\n    display.push((row[4] ? 'new ' : '') + row[3] + ' (' + row[0] + ':' + row[1] + ':' + row[2] + ')');\n  }\n\n  return display;\n};\n\nexports.callStack = function (slice) {\n  // http://code.google.com/p/v8/wiki/JavaScriptStackTraceApi\n  var v8 = Error.prepareStackTrace;\n\n  Error.prepareStackTrace = function (err, stack) {\n    return stack;\n  };\n\n  var capture = {};\n  Error.captureStackTrace(capture, arguments.callee);\n  var stack = capture.stack;\n  Error.prepareStackTrace = v8;\n  var trace = exports.formatStack(stack);\n\n  if (slice) {\n    return trace.slice(slice);\n  }\n\n  return trace;\n};\n\nexports.displayStack = function (slice) {\n  var trace = exports.callStack(slice === undefined ? 1 : slice + 1);\n  return exports.formatTrace(trace);\n};\n\nexports.abortThrow = false;\n\nexports.abort = function (message, hideStack) {\n  if (process.env.NODE_ENV === 'test' || exports.abortThrow === true) {\n    throw new Error(message || 'Unknown error');\n  }\n\n  var stack = '';\n\n  if (!hideStack) {\n    stack = exports.displayStack(1).join('\\n\\t');\n  }\n\n  console.log('ABORT: ' + message + '\\n\\t' + stack);\n  process.exit(1);\n};\n\nexports.assert = function (condition\n/*, msg1, msg2, msg3 */\n) {\n  if (condition) {\n    return;\n  }\n\n  var msgs = Array.prototype.slice.call(arguments, 1);\n  msgs = msgs.map(function (msg) {\n    return typeof msg === 'string' ? msg : msg instanceof Error ? msg.message : JSON.stringify(msg);\n  });\n  throw new Error(msgs.join(' ') || 'Unknown error');\n};\n\nexports.loadDirModules = function (path, excludeFiles, target) {\n  // target(filename, name, capName)\n  var exclude = {};\n\n  for (var i = 0, il = excludeFiles.length; i < il; ++i) {\n    exclude[excludeFiles[i] + '.js'] = true;\n  }\n\n  var files = Fs.readdirSync(path);\n\n  for (i = 0, il = files.length; i < il; ++i) {\n    var filename = files[i];\n\n    if (/\\.js$/.test(filename) && !exclude[filename]) {\n      var name = filename.substr(0, filename.lastIndexOf('.'));\n      var capName = name.charAt(0).toUpperCase() + name.substr(1).toLowerCase();\n\n      if (typeof target !== 'function') {\n        target[capName] = require(path + '/' + name);\n      } else {\n        target(path + '/' + name, name, capName);\n      }\n    }\n  }\n};\n\nexports.rename = function (obj, from, to) {\n  obj[to] = obj[from];\n  delete obj[from];\n};\n\nexports.Timer = function () {\n  this.reset();\n};\n\nexports.Timer.prototype.reset = function () {\n  this.ts = Date.now();\n};\n\nexports.Timer.prototype.elapsed = function () {\n  return Date.now() - this.ts;\n}; // Load and parse package.json process root or given directory\n\n\nexports.loadPackage = function (dir) {\n  var result = {};\n  var filepath = (dir || process.env.PWD) + '/package.json';\n\n  if (Fs.existsSync(filepath)) {\n    try {\n      result = JSON.parse(Fs.readFileSync(filepath));\n    } catch (e) {}\n  }\n\n  return result;\n}; // Escape string for Regex construction\n\n\nexports.escapeRegex = function (string) {\n  // Escape ^$.*+-?=!:|\\/()[]{},\n  return string.replace(/[\\^\\$\\.\\*\\+\\-\\?\\=\\!\\:\\|\\\\\\/\\(\\)\\[\\]\\{\\}\\,]/g, '\\\\$&');\n}; // Return an error as first argument of a callback\n\n\nexports.toss = function (condition\n/*, [message], next */\n) {\n  var message = arguments.length === 3 ? arguments[1] : '';\n  var next = arguments.length === 3 ? arguments[2] : arguments[1];\n  var err = message instanceof Error ? message : message ? new Error(message) : condition instanceof Error ? condition : new Error();\n\n  if (condition instanceof Error || !condition) {\n    return next(err);\n  }\n}; // Base64url (RFC 4648) encode\n\n\nexports.base64urlEncode = function (value) {\n  return new Buffer(value, 'binary').toString('base64').replace(/\\+/g, '-').replace(/\\//g, '_').replace(/\\=/g, '');\n}; // Base64url (RFC 4648) decode\n\n\nexports.base64urlDecode = function (encoded) {\n  if (encoded && !encoded.match(/^[\\w\\-]*$/)) {\n    return new Error('Invalid character');\n  }\n\n  try {\n    return new Buffer(encoded.replace(/-/g, '+').replace(/:/g, '/'), 'base64').toString('binary');\n  } catch (err) {\n    return err;\n  }\n}; // Escape attribute value for use in HTTP header\n\n\nexports.escapeHeaderAttribute = function (attribute) {\n  // Allowed value characters: !#$%&'()*+,-./:;<=>?@[]^_`{|}~ and space, a-z, A-Z, 0-9, \\, \"\n  exports.assert(attribute.match(/^[ \\w\\!#\\$%&'\\(\\)\\*\\+,\\-\\.\\/\\:;<\\=>\\?@\\[\\]\\^`\\{\\|\\}~\\\"\\\\]*$/), 'Bad attribute value (' + attribute + ')');\n  return attribute.replace(/\\\\/g, '\\\\\\\\').replace(/\\\"/g, '\\\\\"'); // Escape quotes and slash\n};\n\nexports.escapeHtml = function (string) {\n  return Escape.escapeHtml(string);\n};\n\nexports.escapeJavaScript = function (string) {\n  return Escape.escapeJavaScript(string);\n};\n/*\r\nvar event = {\r\n    timestamp: now.getTime(),\r\n    tags: ['tag'],\r\n    data: { some: 'data' }\r\n};\r\n*/\n\n\nexports.consoleFunc = console.log;\n\nexports.printEvent = function (event) {\n  var pad = function (value) {\n    return (value < 10 ? '0' : '') + value;\n  };\n\n  var now = new Date(event.timestamp);\n  var timestring = (now.getYear() - 100).toString() + pad(now.getMonth() + 1) + pad(now.getDate()) + '/' + pad(now.getHours()) + pad(now.getMinutes()) + pad(now.getSeconds()) + '.' + now.getMilliseconds();\n  var data = event.data;\n\n  if (typeof event.data !== 'string') {\n    try {\n      data = JSON.stringify(event.data);\n    } catch (e) {\n      data = 'JSON Error: ' + e.message;\n    }\n  }\n\n  var output = timestring + ', ' + event.tags[0] + ', ' + data;\n  exports.consoleFunc(output);\n};\n\nexports.nextTick = function (callback) {\n  return function () {\n    var args = arguments;\n    process.nextTick(function () {\n      callback.apply(null, args);\n    });\n  };\n};","map":{"version":3,"sources":["/home/hayaz/haya/haya/hosters.pk/node_modules/whmcs/node_modules/sntp/node_modules/hoek/lib/index.js"],"names":["Fs","require","Escape","internals","exports","clone","obj","seen","orig","copy","lookup","indexOf","newObj","Array","push","i","hasOwnProperty","Buffer","Date","getTime","RegExp","flags","global","ignoreCase","multiline","source","merge","target","isNullOverride","isMergeArrays","assert","undefined","length","il","keys","Object","k","kl","key","value","applyToDefaults","defaults","options","unique","array","index","result","id","mapToObject","intersect","array1","array2","justFirst","common","hash","found","matchKeys","matched","flatten","isArray","removeKeys","object","reach","chain","path","split","ref","inheritAsync","self","prototype","fn","next","err","formatStack","stack","trace","item","getFileName","getLineNumber","getColumnNumber","getFunctionName","isConstructor","formatTrace","display","row","callStack","slice","v8","Error","prepareStackTrace","capture","captureStackTrace","arguments","callee","displayStack","abortThrow","abort","message","hideStack","process","env","NODE_ENV","join","console","log","exit","condition","msgs","call","map","msg","JSON","stringify","loadDirModules","excludeFiles","exclude","files","readdirSync","filename","test","name","substr","lastIndexOf","capName","charAt","toUpperCase","toLowerCase","rename","from","to","Timer","reset","ts","now","elapsed","loadPackage","dir","filepath","PWD","existsSync","parse","readFileSync","e","escapeRegex","string","replace","toss","base64urlEncode","toString","base64urlDecode","encoded","match","escapeHeaderAttribute","attribute","escapeHtml","escapeJavaScript","consoleFunc","printEvent","event","pad","timestamp","timestring","getYear","getMonth","getDate","getHours","getMinutes","getSeconds","getMilliseconds","data","output","tags","nextTick","callback","args","apply"],"mappings":"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","sourcesContent":["// Load modules\r\n\r\nvar Fs = require('fs');\r\nvar Escape = require('./escape');\r\n\r\n\r\n// Declare internals\r\n\r\nvar internals = {};\r\n\r\n\r\n// Clone object or array\r\n\r\nexports.clone = function (obj, seen) {\r\n\r\n    if (typeof obj !== 'object' ||\r\n        obj === null) {\r\n\r\n        return obj;\r\n    }\r\n\r\n    seen = seen || { orig: [], copy: [] };\r\n\r\n    var lookup = seen.orig.indexOf(obj);\r\n    if (lookup !== -1) {\r\n        return seen.copy[lookup];\r\n    }\r\n\r\n    var newObj = (obj instanceof Array) ? [] : {};\r\n\r\n    seen.orig.push(obj);\r\n    seen.copy.push(newObj);\r\n\r\n    for (var i in obj) {\r\n        if (obj.hasOwnProperty(i)) {\r\n            if (obj[i] instanceof Buffer) {\r\n                newObj[i] = new Buffer(obj[i]);\r\n            }\r\n            else if (obj[i] instanceof Date) {\r\n                newObj[i] = new Date(obj[i].getTime());\r\n            }\r\n            else if (obj[i] instanceof RegExp) {\r\n                var flags = '' + (obj[i].global ? 'g' : '') + (obj[i].ignoreCase ? 'i' : '') + (obj[i].multiline ? 'm' : '');\r\n                newObj[i] = new RegExp(obj[i].source, flags);\r\n            }\r\n            else {\r\n                newObj[i] = exports.clone(obj[i], seen);\r\n            }\r\n        }\r\n    }\r\n\r\n    return newObj;\r\n};\r\n\r\n\r\n// Merge all the properties of source into target, source wins in conflic, and by default null and undefined from source are applied\r\n\r\nexports.merge = function (target, source, isNullOverride /* = true */, isMergeArrays /* = true */) {\r\n\r\n    exports.assert(target && typeof target == 'object', 'Invalid target value: must be an object');\r\n    exports.assert(source === null || source === undefined || typeof source === 'object', 'Invalid source value: must be null, undefined, or an object');\r\n\r\n    if (!source) {\r\n        return target;\r\n    }\r\n\r\n    if (source instanceof Array) {\r\n        exports.assert(target instanceof Array, 'Cannot merge array onto an object');\r\n        if (isMergeArrays === false) {                                                  // isMergeArrays defaults to true\r\n            target.length = 0;                                                          // Must not change target assignment\r\n        }\r\n\r\n        for (var i = 0, il = source.length; i < il; ++i) {\r\n            target.push(source[i]);\r\n        }\r\n\r\n        return target;\r\n    }\r\n\r\n    var keys = Object.keys(source);\r\n    for (var k = 0, kl = keys.length; k < kl; ++k) {\r\n        var key = keys[k];\r\n        var value = source[key];\r\n        if (value &&\r\n            typeof value === 'object') {\r\n\r\n            if (!target[key] ||\r\n                typeof target[key] !== 'object') {\r\n\r\n                target[key] = exports.clone(value);\r\n            }\r\n            else {\r\n                exports.merge(target[key], source[key], isNullOverride, isMergeArrays);\r\n            }\r\n        }\r\n        else {\r\n            if (value !== null && value !== undefined) {            // Explicit to preserve empty strings\r\n                target[key] = value;\r\n            }\r\n            else if (isNullOverride !== false) {                    // Defaults to true\r\n                target[key] = value;\r\n            }\r\n        }\r\n    }\r\n\r\n    return target;\r\n};\r\n\r\n\r\n// Apply options to a copy of the defaults\r\n\r\nexports.applyToDefaults = function (defaults, options) {\r\n\r\n    exports.assert(defaults && typeof defaults == 'object', 'Invalid defaults value: must be an object');\r\n    exports.assert(!options || options === true || typeof options === 'object', 'Invalid options value: must be true, falsy or an object');\r\n\r\n    if (!options) {                                                 // If no options, return null\r\n        return null;\r\n    }\r\n\r\n    var copy = exports.clone(defaults);\r\n\r\n    if (options === true) {                                         // If options is set to true, use defaults\r\n        return copy;\r\n    }\r\n\r\n    return exports.merge(copy, options, false, false);\r\n};\r\n\r\n\r\n// Remove duplicate items from array\r\n\r\nexports.unique = function (array, key) {\r\n\r\n    var index = {};\r\n    var result = [];\r\n\r\n    for (var i = 0, il = array.length; i < il; ++i) {\r\n        var id = (key ? array[i][key] : array[i]);\r\n        if (index[id] !== true) {\r\n\r\n            result.push(array[i]);\r\n            index[id] = true;\r\n        }\r\n    }\r\n\r\n    return result;\r\n};\r\n\r\n\r\n// Convert array into object\r\n\r\nexports.mapToObject = function (array, key) {\r\n\r\n    if (!array) {\r\n        return null;\r\n    }\r\n\r\n    var obj = {};\r\n    for (var i = 0, il = array.length; i < il; ++i) {\r\n        if (key) {\r\n            if (array[i][key]) {\r\n                obj[array[i][key]] = true;\r\n            }\r\n        }\r\n        else {\r\n            obj[array[i]] = true;\r\n        }\r\n    }\r\n\r\n    return obj;\r\n};\r\n\r\n\r\n// Find the common unique items in two arrays\r\n\r\nexports.intersect = function (array1, array2, justFirst) {\r\n\r\n    if (!array1 || !array2) {\r\n        return [];\r\n    }\r\n\r\n    var common = [];\r\n    var hash = (array1 instanceof Array ? exports.mapToObject(array1) : array1);\r\n    var found = {};\r\n    for (var i = 0, il = array2.length; i < il; ++i) {\r\n        if (hash[array2[i]] && !found[array2[i]]) {\r\n            if (justFirst) {\r\n                return array2[i];\r\n            }\r\n\r\n            common.push(array2[i]);\r\n            found[array2[i]] = true;\r\n        }\r\n    }\r\n\r\n    return (justFirst ? null : common);\r\n};\r\n\r\n\r\n// Find which keys are present\r\n\r\nexports.matchKeys = function (obj, keys) {\r\n\r\n    var matched = [];\r\n    for (var i = 0, il = keys.length; i < il; ++i) {\r\n        if (obj.hasOwnProperty(keys[i])) {\r\n            matched.push(keys[i]);\r\n        }\r\n    }\r\n    return matched;\r\n};\r\n\r\n\r\n// Flatten array\r\n\r\nexports.flatten = function (array, target) {\r\n\r\n    var result = target || [];\r\n\r\n    for (var i = 0, il = array.length; i < il; ++i) {\r\n        if (Array.isArray(array[i])) {\r\n            exports.flatten(array[i], result);\r\n        }\r\n        else {\r\n            result.push(array[i]);\r\n        }\r\n    }\r\n\r\n    return result;\r\n};\r\n\r\n\r\n// Remove keys\r\n\r\nexports.removeKeys = function (object, keys) {\r\n\r\n    for (var i = 0, il = keys.length; i < il; i++) {\r\n        delete object[keys[i]];\r\n    }\r\n};\r\n\r\n\r\n// Convert an object key chain string ('a.b.c') to reference (object[a][b][c])\r\n\r\nexports.reach = function (obj, chain) {\r\n\r\n    var path = chain.split('.');\r\n    var ref = obj;\r\n    for (var i = 0, il = path.length; i < il; ++i) {\r\n        if (ref) {\r\n            ref = ref[path[i]];\r\n        }\r\n    }\r\n\r\n    return ref;\r\n};\r\n\r\n\r\n// Inherits a selected set of methods from an object, wrapping functions in asynchronous syntax and catching errors\r\n\r\nexports.inheritAsync = function (self, obj, keys) {\r\n\r\n    keys = keys || null;\r\n\r\n    for (var i in obj) {\r\n        if (obj.hasOwnProperty(i)) {\r\n            if (keys instanceof Array &&\r\n                keys.indexOf(i) < 0) {\r\n\r\n                continue;\r\n            }\r\n\r\n            self.prototype[i] = (function (fn) {\r\n\r\n                return function (next) {\r\n\r\n                    var result = null;\r\n                    try {\r\n                        result = fn();\r\n                    }\r\n                    catch (err) {\r\n                        return next(err);\r\n                    }\r\n\r\n                    return next(null, result);\r\n                };\r\n            })(obj[i]);\r\n        }\r\n    }\r\n};\r\n\r\n\r\nexports.formatStack = function (stack) {\r\n\r\n    var trace = [];\r\n    for (var i = 0, il = stack.length; i < il; ++i) {\r\n        var item = stack[i];\r\n        trace.push([item.getFileName(), item.getLineNumber(), item.getColumnNumber(), item.getFunctionName(), item.isConstructor()]);\r\n    }\r\n\r\n    return trace;\r\n};\r\n\r\n\r\nexports.formatTrace = function (trace) {\r\n\r\n    var display = [];\r\n\r\n    for (var i = 0, il = trace.length; i < il; ++i) {\r\n        var row = trace[i];\r\n        display.push((row[4] ? 'new ' : '') + row[3] + ' (' + row[0] + ':' + row[1] + ':' + row[2] + ')');\r\n    }\r\n\r\n    return display;\r\n};\r\n\r\n\r\nexports.callStack = function (slice) {\r\n\r\n    // http://code.google.com/p/v8/wiki/JavaScriptStackTraceApi\r\n\r\n    var v8 = Error.prepareStackTrace;\r\n    Error.prepareStackTrace = function (err, stack) {\r\n\r\n        return stack;\r\n    };\r\n\r\n    var capture = {};\r\n    Error.captureStackTrace(capture, arguments.callee);\r\n    var stack = capture.stack;\r\n\r\n    Error.prepareStackTrace = v8;\r\n\r\n    var trace = exports.formatStack(stack);\r\n\r\n    if (slice) {\r\n        return trace.slice(slice);\r\n    }\r\n\r\n    return trace;\r\n};\r\n\r\n\r\nexports.displayStack = function (slice) {\r\n\r\n    var trace = exports.callStack(slice === undefined ? 1 : slice + 1);\r\n\r\n    return exports.formatTrace(trace);\r\n};\r\n\r\n\r\nexports.abortThrow = false;\r\n\r\n\r\nexports.abort = function (message, hideStack) {\r\n\r\n    if (process.env.NODE_ENV === 'test' || exports.abortThrow === true) {\r\n        throw new Error(message || 'Unknown error');\r\n    }\r\n\r\n    var stack = '';\r\n    if (!hideStack) {\r\n        stack = exports.displayStack(1).join('\\n\\t');\r\n    }\r\n    console.log('ABORT: ' + message + '\\n\\t' + stack);\r\n    process.exit(1);\r\n};\r\n\r\n\r\nexports.assert = function (condition /*, msg1, msg2, msg3 */) {\r\n\r\n    if (condition) {\r\n        return;\r\n    }\r\n\r\n    var msgs = Array.prototype.slice.call(arguments, 1);\r\n    msgs = msgs.map(function (msg) {\r\n\r\n        return typeof msg === 'string' ? msg : msg instanceof Error ? msg.message : JSON.stringify(msg);\r\n    });\r\n    throw new Error(msgs.join(' ') || 'Unknown error');\r\n};\r\n\r\n\r\nexports.loadDirModules = function (path, excludeFiles, target) {      // target(filename, name, capName)\r\n\r\n    var exclude = {};\r\n    for (var i = 0, il = excludeFiles.length; i < il; ++i) {\r\n        exclude[excludeFiles[i] + '.js'] = true;\r\n    }\r\n\r\n    var files = Fs.readdirSync(path);\r\n    for (i = 0, il = files.length; i < il; ++i) {\r\n        var filename = files[i];\r\n        if (/\\.js$/.test(filename) &&\r\n            !exclude[filename]) {\r\n\r\n            var name = filename.substr(0, filename.lastIndexOf('.'));\r\n            var capName = name.charAt(0).toUpperCase() + name.substr(1).toLowerCase();\r\n\r\n            if (typeof target !== 'function') {\r\n                target[capName] = require(path + '/' + name);\r\n            }\r\n            else {\r\n                target(path + '/' + name, name, capName);\r\n            }\r\n        }\r\n    }\r\n};\r\n\r\n\r\nexports.rename = function (obj, from, to) {\r\n\r\n    obj[to] = obj[from];\r\n    delete obj[from];\r\n};\r\n\r\n\r\nexports.Timer = function () {\r\n\r\n    this.reset();\r\n};\r\n\r\n\r\nexports.Timer.prototype.reset = function () {\r\n\r\n    this.ts = Date.now();\r\n};\r\n\r\n\r\nexports.Timer.prototype.elapsed = function () {\r\n\r\n    return Date.now() - this.ts;\r\n};\r\n\r\n\r\n// Load and parse package.json process root or given directory\r\n\r\nexports.loadPackage = function (dir) {\r\n\r\n    var result = {};\r\n    var filepath = (dir || process.env.PWD) + '/package.json';\r\n    if (Fs.existsSync(filepath)) {\r\n        try {\r\n            result = JSON.parse(Fs.readFileSync(filepath));\r\n        }\r\n        catch (e) { }\r\n    }\r\n\r\n    return result;\r\n};\r\n\r\n\r\n// Escape string for Regex construction\r\n\r\nexports.escapeRegex = function (string) {\r\n\r\n    // Escape ^$.*+-?=!:|\\/()[]{},\r\n    return string.replace(/[\\^\\$\\.\\*\\+\\-\\?\\=\\!\\:\\|\\\\\\/\\(\\)\\[\\]\\{\\}\\,]/g, '\\\\$&');\r\n};\r\n\r\n\r\n// Return an error as first argument of a callback\r\n\r\nexports.toss = function (condition /*, [message], next */) {\r\n\r\n    var message = (arguments.length === 3 ? arguments[1] : '');\r\n    var next = (arguments.length === 3 ? arguments[2] : arguments[1]);\r\n\r\n    var err = (message instanceof Error ? message : (message ? new Error(message) : (condition instanceof Error ? condition : new Error())));\r\n\r\n    if (condition instanceof Error ||\r\n        !condition) {\r\n\r\n        return next(err);\r\n    }\r\n};\r\n\r\n\r\n// Base64url (RFC 4648) encode\r\n\r\nexports.base64urlEncode = function (value) {\r\n\r\n    return (new Buffer(value, 'binary')).toString('base64').replace(/\\+/g, '-').replace(/\\//g, '_').replace(/\\=/g, '');\r\n};\r\n\r\n\r\n// Base64url (RFC 4648) decode\r\n\r\nexports.base64urlDecode = function (encoded) {\r\n\r\n    if (encoded &&\r\n        !encoded.match(/^[\\w\\-]*$/)) {\r\n\r\n        return new Error('Invalid character');\r\n    }\r\n\r\n    try {\r\n        return (new Buffer(encoded.replace(/-/g, '+').replace(/:/g, '/'), 'base64')).toString('binary');\r\n    }\r\n    catch (err) {\r\n        return err;\r\n    }\r\n};\r\n\r\n\r\n// Escape attribute value for use in HTTP header\r\n\r\nexports.escapeHeaderAttribute = function (attribute) {\r\n\r\n    // Allowed value characters: !#$%&'()*+,-./:;<=>?@[]^_`{|}~ and space, a-z, A-Z, 0-9, \\, \"\r\n\r\n    exports.assert(attribute.match(/^[ \\w\\!#\\$%&'\\(\\)\\*\\+,\\-\\.\\/\\:;<\\=>\\?@\\[\\]\\^`\\{\\|\\}~\\\"\\\\]*$/), 'Bad attribute value (' + attribute + ')');\r\n\r\n    return attribute.replace(/\\\\/g, '\\\\\\\\').replace(/\\\"/g, '\\\\\"');                             // Escape quotes and slash\r\n};\r\n\r\n\r\nexports.escapeHtml = function (string) {\r\n\r\n    return Escape.escapeHtml(string);\r\n};\r\n\r\n\r\nexports.escapeJavaScript = function (string) {\r\n\r\n    return Escape.escapeJavaScript(string);\r\n};\r\n\r\n\r\n/*\r\nvar event = {\r\n    timestamp: now.getTime(),\r\n    tags: ['tag'],\r\n    data: { some: 'data' }\r\n};\r\n*/\r\n\r\nexports.consoleFunc = console.log;\r\n\r\nexports.printEvent = function (event) {\r\n\r\n    var pad = function (value) {\r\n\r\n        return (value < 10 ? '0' : '') + value;\r\n    };\r\n\r\n    var now = new Date(event.timestamp);\r\n    var timestring = (now.getYear() - 100).toString() +\r\n        pad(now.getMonth() + 1) +\r\n        pad(now.getDate()) +\r\n        '/' +\r\n        pad(now.getHours()) +\r\n        pad(now.getMinutes()) +\r\n        pad(now.getSeconds()) +\r\n        '.' +\r\n        now.getMilliseconds();\r\n\r\n    var data = event.data;\r\n    if (typeof event.data !== 'string') {\r\n        try {\r\n            data = JSON.stringify(event.data);\r\n        }\r\n        catch (e) {\r\n            data = 'JSON Error: ' + e.message;\r\n        }\r\n    }\r\n\r\n    var output = timestring + ', ' + event.tags[0] + ', ' + data;\r\n    exports.consoleFunc(output);\r\n};\r\n\r\n\r\nexports.nextTick = function (callback) {\r\n\r\n    return function () {\r\n\r\n        var args = arguments;\r\n        process.nextTick(function () {\r\n\r\n            callback.apply(null, args);\r\n        });\r\n    };\r\n};\r\n"]},"metadata":{},"sourceType":"script"}